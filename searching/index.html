<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
	</head>
    <body>
        <div id="apitweet">
            <form method="post" id="formulaire">
                <fieldset>
                    <legend>Recherche de tweets</legend>
                    <label>
                        Mot-clé :
                        <input type="text" name="keyword">
                    </label>
                    <label>
                        Nombre :
                        <input type="number" name="quantity">
                    </label>
                    <label>
                        Langage :
                        <select name="language">
                            <option value="eu"></option>
                            <option value="eu"></option>
                            <option value="eu"></option>
                            <option value="eu"></option>
                        </select>
                    </label>
                    <label>
                        Filtrer par :
                        <select name="type">
                            <option value="mixed">Défaut</option>
                            <option value="recent">Récent</option>
                            <option value="popular">Populaire</option>
                        </select>
                    </label>
                    <label>
                        Date maximale de publication :
                        <input type="date" name="date_pub">
                    </label>
                    <br>
                    <input type="submit" value="Envoyer">
                </fieldset>
            </form>
        </div>

        <!-- <script type="text/javascript" src="qry.js"></script> -->

        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>

        <script src="searching/code/highcharts.js"></script>
        <script src="searching/code/highcharts-3d.js"></script>
        <script src="searching/code/modules/exporting.js"></script>
        
        <div id="container" style="height: 400px"></div>
        
        <script>
            $(document).ready(function(){
                
                /* SOCKET */         
                var socket = io.connect('http://localhost:8080');

                $('#formulaire').submit(function (event) {
                    event.preventDefault();

                    var inputs = $('#formulaire :input');
                    var values = {};

                    inputs.each(function() {
                        values[this.name] = $(this).val();
                    });
        
                    if(values.keyword != "")
                        socket.emit('search', values);
        
                    return false;
                });

                /* DATAVISUALISATION */
                
                var optionsHighCharts = {
                    chart: {
                        type: 'pie',
                        options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                        }
                    },
                    title: {
                        text: 'Browser market shares at a specific website, 2014'
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            depth: 35,
                            dataLabels: {
                                enabled: true,
                                format: '{point.name}'
                            }
                        }
                    }
                };

                // Quand on récupère une liste de tweets, on met dans des graphs
                socket.on('search', function(data) {
                    
                    optionsHighCharts.series = [{
                        type: 'pie',
                        name: 'Browser share',
                        data: [
                            ['Firefox', 45.0],
                            ['IE', 26.8],
                            {
                                name: 'Chrome',
                                y: 12.8,
                                sliced: true,
                                selected: true
                            },
                            ['Safari', 8.5],
                            ['Opera', 6.2],
                            ['Others', 0.7]
                        ]
                    }];
                   
                    Highcharts.chart('container', optionsHighCharts);
                });
            });
        </script>       
    </body>
</html>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
	</head>
    <body>
        <div id="apitweet">
            <form method="post" id="formulaire">
                <fieldset>
                    <legend>Recherche de tweets</legend>
                    <label>
                        Mot-clé :
                        <input type="text" name="keyword">
                    </label>
                    <label>
                        Nombre :
                        <input type="number" name="quantity">
                    </label>
                    <label>
                        Langage :
                        <select name="language">
                            <option value="eu"></option>
                            <option value="eu"></option>
                            <option value="eu"></option>
                            <option value="eu"></option>
                        </select>
                    </label>
                    <label>
                        Filtrer par :
                        <select name="type">
                            <option value="mixed">Défaut</option>
                            <option value="recent">Récent</option>
                            <option value="popular">Populaire</option>
                        </select>
                    </label>
                    <label>
                        Date maximale de publication :
                        <input type="date" name="date_pub">
                    </label>
                    <br>
                    <input type="submit" value="Envoyer">
                </fieldset>
            </form>
        </div>

        <!-- <script type="text/javascript" src="qry.js"></script> -->

        <script src="searching/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="searching/code/highcharts.js"></script>
        <script src="searching/code/highcharts-3d.js"></script>
        <script src="searching/code/modules/exporting.js"></script>
        <script src="searching/code/modules/data.js"></script>
        <script src="searching/code/modules/drilldown.js"></script>
        <script src="searching/code/modules/export-data.js"></script>
        
        <div id="container" style="height: 400px"></div>
        <div id="container2" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
        <div id="container3" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

        

        <script type="text/javascript">
            $(document).ready(function(){
                /* SOCKET */         
                var socket = io.connect('http://localhost:8080');

                $('#formulaire').submit(function (event) {
                    event.preventDefault();

                    var inputs = $('#formulaire :input');
                    var values = {};

                    inputs.each(function() {
                        values[this.name] = $(this).val();
                    });
        
                    if(values.keyword != "")
                        socket.emit('search', values);
        
                    return false;
                });

                /* DATAVISUALISATION */
                //chart 1
                var optionsHighCharts = {
                    chart: {
                        type: 'pie',
                        options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                        }
                    },
                    title: {
                        text: 'Les régions utilisant le plus ce mot-clé'
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            depth: 35,
                            dataLabels: {
                                enabled: true,
                                format: '{point.name}'
                            }
                        }
                    }
                };
                //chart 2
                var optionsHighCharts2 = {
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: 'Le nombre de partage par twit'
                    },
                    subtitle: {
                        text: ''
                    },
                    xAxis: {
                        type: 'category'
                    },
                    yAxis: {
                        title: {
                            text: 'Nombre de partage'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        series: {
                            borderWidth: 0,
                            dataLabels: {
                                enabled: true,
                                format: '{point.y:.1f}%'
                            }
                        }
                    },

                    tooltip: {
                        headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                        pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
                    }
                };
                //chart 3
                var optionsHighCharts3 = {
                    chart: {
                        type: 'area'
                    },
                    title: {
                        text: 'Evolution du nombre de tweets publiés dans la semaine'
                    },
                    xAxis: {
                        allowDecimals: false,
                        labels: {
                            formatter: function () {
                                return this.value; // clean, unformatted number for year
                            }
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Nombre de tweets publiés'
                        },
                        labels: {
                            formatter: function () {
                                return this.value / 100;
                            }
                        }
                    },
                    tooltip: {
                        pointFormat: '<b>{point.y:,.0f}</b> tweets publiés le jour n°{point.x}'
                    },
                    plotOptions: {
                        area: {
                            pointStart: 1,
                            marker: {
                                enabled: false,
                                symbol: 'circle',
                                radius: 2,
                                states: {
                                    hover: {
                                        enabled: true
                                    }
                                }
                            }
                        }
                    }
                };

                // Quand on récupère une liste de tweets, on met dans des graphs
                socket.on('search', function(data) {
                    optionsHighCharts.series = [{
                        type: 'pie',
                        name: 'Browser share',
                        data: data.first
                    }];
                    optionsHighCharts2.series = [{
                        name: 'Brands',
                        colorByPoint: true,
                        data: [{
                            name: 'Pierre',
                            y: 56.33,
                            drilldown: 'Pierre'
                        }, {
                            name: 'Mahmoud',
                            y: 24.03,
                            drilldown: 'Mahmoud'
                        }, {
                            name: 'Jack',
                            y: 10.38,
                            drilldown: 'Jack'
                        }, {
                            name: 'Rémie',
                            y: 4.77,
                            drilldown: 'Rémie'
                        }, {
                            name: 'Nancy',
                            y: 0.91,
                            drilldown: 'Nancy'
                        }, {
                            name: 'Guillaume',
                            y: 0.2,
                            drilldown: null
                        }]
                    }];      
                    optionsHighCharts3.series = [{
                        name: 'Volume',
                        data: /*data.third*/
                        [
                            5113, 5113, 4954, 4804, 4761, 4717, 4368
                        ]
                    }];

                    Highcharts.chart('container', optionsHighCharts);
                    Highcharts.chart('container2', optionsHighCharts2);
                    Highcharts.chart('container3', optionsHighCharts3);
                });
            });
        </script>       
    </body>
</html>
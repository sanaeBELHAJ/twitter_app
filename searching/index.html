<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
	</head>
    <body>
        <div id="apitweet">
            <form method="post" id="formulaire">
                <fieldset>
                    <legend>Recherche de tweets</legend>
                    <label>
                        Mot-clé :
                        <input type="text" name="keyword">
                    </label>
                    <label>
                        Nombre :
                        <input type="number" name="quantity">
                    </label>
                    <label>
                        Langage :
                        <select name="language">
                            <option value="eu"></option>
                            <option value="eu"></option>
                            <option value="eu"></option>
                            <option value="eu"></option>
                        </select>
                    </label>
                    <label>
                        Filtrer par :
                        <select name="type">
                            <option value="mixed">Défaut</option>
                            <option value="recent">Récent</option>
                            <option value="popular">Populaire</option>
                        </select>
                    </label>
                    <label>
                        Date maximale de publication :
                        <input type="date" name="date_pub">
                    </label>
                    <br>
                    <input type="submit" value="Envoyer">
                </fieldset>
            </form>
        </div>

        <!-- <script type="text/javascript" src="qry.js"></script> -->

        <script src="searching/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="searching/code/highcharts.js"></script>
        <script src="searching/code/highcharts-3d.js"></script>
        <script src="searching/code/modules/exporting.js"></script>
        <script src="searching/code/modules/data.js"></script>
        <script src="searching/code/modules/drilldown.js"></script>
        <script src="searching/code/modules/export-data.js"></script>
        
        <div id="container" style="height: 400px"></div>
        <div id="container2" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
        <div id="container3" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

        

        <script type="text/javascript">
            $(document).ready(function(){
                /* SOCKET */         
                var socket = io.connect('http://localhost:8080');

                $('#formulaire').submit(function (event) {
                    event.preventDefault();

                    var inputs = $('#formulaire :input');
                    var values = {};

                    inputs.each(function() {
                        values[this.name] = $(this).val();
                    });
        
                    if(values.keyword != "")
                        socket.emit('search', values);
        
                    return false;
                });

                /* DATAVISUALISATION */
                //chart 1
                var optionsHighCharts = {
                    chart: {
                        type: 'pie',
                        options3d: {
                            enabled: true,
                            alpha: 45,
                            beta: 0
                        }
                    },
                    title: {
                        text: 'Les langues les plus utilisant de ce mot'
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            depth: 35,
                            dataLabels: {
                                enabled: true,
                                format: '{point.name}'
                            }
                        }
                    }
                };
                //chart 2
                var optionsHighCharts2 = {
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: 'Le nombre de partage par twit'
                    },
                    subtitle: {
                        text: ''
                    },
                    xAxis: {
                        type: 'category'
                    },
                    yAxis: {
                        title: {
                            text: 'Nombre de partage'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        series: {
                            borderWidth: 0,
                            dataLabels: {
                                enabled: true,
                                format: '{point.y:.1f}%'
                            }
                        }
                    },

                    tooltip: {
                        headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                        pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
                    }
                };
                //chart 3
                var optionsHighCharts3 = {
                    chart: {
                        type: 'area'
                    },
                    title: {
                        text: 'US and USSR nuclear stockpiles'
                    },
                    subtitle: {
                        text: 'Sources: <a href="https://thebulletin.org/2006/july/global-nuclear-stockpiles-1945-2006">' +
                            'thebulletin.org</a> &amp; <a href="https://www.armscontrol.org/factsheets/Nuclearweaponswhohaswhat">' +
                            'armscontrol.org</a>'
                    },
                    xAxis: {
                        allowDecimals: false,
                        labels: {
                            formatter: function () {
                                return this.value; // clean, unformatted number for year
                            }
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Nuclear weapon states'
                        },
                        labels: {
                            formatter: function () {
                                return this.value / 1000 + 'k';
                            }
                        }
                    },
                    tooltip: {
                        pointFormat: '{series.name} had stockpiled <b>{point.y:,.0f}</b><br/>warheads in {point.x}'
                    },
                    plotOptions: {
                        area: {
                            pointStart: 1940,
                            marker: {
                                enabled: false,
                                symbol: 'circle',
                                radius: 2,
                                states: {
                                    hover: {
                                        enabled: true
                                    }
                                }
                            }
                        }
                    }
                };

                // Quand on récupère une liste de tweets, on met dans des graphs
                socket.on('search', function(data) {
                    optionsHighCharts.series = [{
                        type: 'pie',
                        name: 'Browser share',
                        data: data.first
                    }];
                    optionsHighCharts2.series = [{
                        name: 'Brands',
                        colorByPoint: true,
                        data: [{
                            name: 'Pierre',
                            y: 56.33,
                            drilldown: 'Pierre'
                        }, {
                            name: 'Mahmoud',
                            y: 24.03,
                            drilldown: 'Mahmoud'
                        }, {
                            name: 'Jack',
                            y: 10.38,
                            drilldown: 'Jack'
                        }, {
                            name: 'Rémie',
                            y: 4.77,
                            drilldown: 'Rémie'
                        }, {
                            name: 'Nancy',
                            y: 0.91,
                            drilldown: 'Nancy'
                        }, {
                            name: 'Guillaume',
                            y: 0.2,
                            drilldown: null
                        }]
                    }];      
                    optionsHighCharts3.series = [{
                        name: 'USA',
                        data: data.third
                        /*[
                            null, null, null, null, null, 6, 11, 32, 110, 235,
                            369, 640, 1005, 1436, 2063, 3057, 4618, 6444, 9822, 15468,
                            20434, 24126, 27387, 29459, 31056, 31982, 32040, 31233, 29224, 27342,
                            26662, 26956, 27912, 28999, 28965, 27826, 25579, 25722, 24826, 24605,
                            24304, 23464, 23708, 24099, 24357, 24237, 24401, 24344, 23586, 22380,
                            21004, 17287, 14747, 13076, 12555, 12144, 11009, 10950, 10871, 10824,
                            10577, 10527, 10475, 10421, 10358, 10295, 10104, 9914, 9620, 9326,
                            5113, 5113, 4954, 4804, 4761, 4717, 4368, 4018
                        ]*/
                    }];

                    Highcharts.chart('container', optionsHighCharts);
                    Highcharts.chart('container2', optionsHighCharts2);
                    Highcharts.chart('container3', optionsHighCharts3);
                });
            });
        </script>       
    </body>
</html>